machine:
  node:
    version: v6.10.3
  environment:
    LANG: en_US.utf8
dependencies:
  pre:
    - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" >> ~/.npmrc
  override:
    - npm install
test:
  override:
    - npm run build
deployment:
  production:
    branch: master
    commands:
      - git config --global user.email "webteam@coderdojo.com"
      - git config --global user.name "CoderDojo Foundation"
      - npm version patch -m "[skip ci] Update to %s"
      - git push
      - npm publish
  staging:
    branch: staging
    commands:
      - npm --no-git-tag-version version `node build/get-version.js`-`git rev-parse --short HEAD`
      - npm publish --tag=staging
